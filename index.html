<!-- <script>
  try {
    // Get the current URL
    const currentUrl = new URL(window.location.href);

    // Extract the 'domain' and 'page' parameters
    const urlParams = new URLSearchParams(currentUrl.search);
    const domainName = urlParams.get('domain');
    const pageName = urlParams.get('page');

    console.log("Current URL:", currentUrl.href);
    console.log("Domain Parameter:", domainName);
    console.log("Page Parameter:", pageName);

    // Validate parameters
    if (!domainName) {
      console.error("Domain parameter is missing!");
      throw new Error("Domain parameter is required.");
    }

    // Replace the base domain
    let updatedUrl = new URL(currentUrl.href.replace("yadavumakants.github.io/aeroid", domainName));

    // Replace 'index.html' with the specified page if the page parameter exists
    if (pageName) {
      updatedUrl = new URL(updatedUrl.href.replace("index.html", pageName));
    }

    console.log("Updated URL before redirection:", updatedUrl.href);

    // Remove the 'domain' and 'page' parameters
    updatedUrl.searchParams.delete("domain");
    updatedUrl.searchParams.delete("page");
    updatedUrl = new URL(updatedUrl.href.replace("%2F", ""));
    console.log("Final URL for redirection:", updatedUrl.href);

    // Perform the redirection
    window.location.href = updatedUrl.href;
  } catch (error) {
    console.error("Error occurred during redirection:", error);
  }
</script>
 -->
<script>
  (async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const domain = urlParams.get('domain');
    const page = urlParams.get('page') || 'index.html';
    const fallback = urlParams.get('fallback');

    if (!domain) {
      console.error("Missing 'domain' parameter");
      return;
    }

    const targetUrl = domain.replace(/\/$/, '') + '/' + page;
    const pingUrl = domain.replace(/\/$/, '') + '/favicon.ico'; // or any small public file

    const fallbackUrl = fallback ? fallback.replace(/\/$/, '') + '/' + page : null;

    console.log("Trying to reach:", pingUrl);

    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 5000); // 5-second timeout

    try {
      const response = await fetch(pingUrl, {
        mode: 'cors',
        method: 'GET',
        signal: controller.signal,
      });

      clearTimeout(timeout);

      if (response.ok || response.type === 'opaque') {
        console.log("Domain is reachable. Redirecting to:", targetUrl);
        window.location.href = targetUrl;
      } else {
        throw new Error("Ping failed with status: " + response.status);
      }

    } catch (err) {
      clearTimeout(timeout);
      console.warn("Primary domain not reachable:", err);

      if (fallbackUrl) {
        console.warn("Redirecting to fallback:", fallbackUrl);
        window.location.href = fallbackUrl;
      } else {
        alert("Target domain unreachable, and no fallback provided.");
      }
    }
  })();
</script>
