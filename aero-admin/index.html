<script>
  async function checkDomainReachable(url) {
    try {
      // Use HEAD to minimize load, set short timeout
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 3000); // 3s timeout
      const response = await fetch(url, { method: "HEAD", mode: "no-cors", signal: controller.signal });
      clearTimeout(timeout);
      // Even opaque response (no-cors) counts as reachable
      return true;
    } catch (e) {
      return false;
    }
  }

  (async () => {
    try {
      const currentUrl = new URL(window.location.href);
      const urlParams = new URLSearchParams(currentUrl.search);
      const domainName = urlParams.get("domain");
      const pageName = urlParams.get("page");

      if (!domainName) {
        console.error("Domain parameter is missing!");
        throw new Error("Domain parameter is required.");
      }

      // Replace the base domain
      let updatedUrl = new URL(
        currentUrl.href.replace("yadavumakants.github.io/aeroid", domainName)
      );

      // Replace 'index.html' with page if provided
      if (pageName) {
        updatedUrl = new URL(updatedUrl.href.replace("index.html", pageName));
      }

      // Clean params
      updatedUrl.searchParams.delete("domain");
      updatedUrl.searchParams.delete("page");
      updatedUrl = new URL(updatedUrl.href.replace("%2F", ""));

      console.log("Trying domain:", updatedUrl.href);

      // Check if domain is reachable
      const isReachable = await checkDomainReachable(updatedUrl.origin);

      if (!isReachable) {
        console.warn("Domain unreachable. Falling back to aeroid.in");
        updatedUrl = new URL(updatedUrl.href.replace(domainName, "aeroid.in"));
      }

      console.log("Final URL for redirection:", updatedUrl.href);

      window.location.href = updatedUrl.href;
    } catch (error) {
      console.error("Error occurred during redirection:", error);
    }
  })();
</script>
