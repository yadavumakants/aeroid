<script>
  function checkReachable(domain, timeout = 1000) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      const timer = setTimeout(() => { img.src = ""; reject(); }, timeout);
      img.onload = () => { clearTimeout(timer); resolve(domain); };
      img.onerror = () => { clearTimeout(timer); reject(); };
      img.src = domain + "/favicon.ico?" + Date.now();
    });
  }

  (async () => {
    try {
      const currentUrl = new URL(window.location.href);
      const urlParams = new URLSearchParams(currentUrl.search);
      const domainName = urlParams.get("domain");
      const pageName = urlParams.get("page") || "index.html";

      if (!domainName) throw new Error("Domain parameter is required.");

      // Build final path like your original logic
      let path = currentUrl.pathname
        .replace("/aeroid/", "/")
        .replace("index.html", pageName);

      if (!path.startsWith("/")) path = "/" + path;

      const searchParams = new URLSearchParams(currentUrl.search);
      searchParams.delete("domain");
      searchParams.delete("page");
      const query = searchParams.toString();
      if (query) path += "?" + query;

      // Domains in priority order
      const candidates = [
        "https://" + domainName,
        "https://aeroid.in",
        "https://aeroid1.in"
      ];

      // Launch all reachability checks in parallel
      const results = await Promise.allSettled(
        candidates.map(d => checkReachable(d))
      );

      // Pick the first reachable in priority order
      let finalUrl = null;
      for (let i = 0; i < candidates.length; i++) {
        if (results[i].status === "fulfilled") {
          finalUrl = candidates[i] + path;
          break;
        }
      }

      if (!finalUrl) {
        alert("Server is down, Please try after some time");
        return;
      }

      console.log("Redirecting to:", finalUrl);
      window.location.href = finalUrl;
    } catch (e) {
      console.error("Redirection error:", e);
      alert("Server is down, Please try after some time");
    }
  })();
</script>
